<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home Budget Calculator</title>

  <style>
    /* =========================
       SOFT GRADIENT BACKGROUND + CARD (style 'c')
       ========================= */
    :root{
      --bgA: #eef6ff;
      --bgB: #f7fbff;
      --card-bg: #ffffff;
      --accent: #2b6cb0;
      --muted: #6b7280;
      --danger: #dc3545;
      --success: #10b981;
      --radius: 16px;
      --gap: 14px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}

    body{
      min-height:100%;
      background: linear-gradient(135deg, var(--bgA) 0%, #f2fbff 50%, var(--bgB) 100%);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:28px;
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* main card container */
    .container{
      width:100%;
      max-width:980px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 18px 50px rgba(16,24,40,0.12);
      padding:26px;
      overflow:hidden;
    }

    .greeting{
      background: linear-gradient(90deg, rgba(59,130,246,0.06), rgba(96,165,250,0.02));
      border-left:6px solid rgba(59,130,246,0.85);
      padding:16px 18px;
      border-radius:12px;
      margin-bottom:18px;
      font-weight:600;
      color:#083344;
      line-height:1.35;
    }

    .section{background:transparent;margin-bottom:16px}

    .top-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:6px}

    label{display:flex;gap:10px;align-items:center;font-weight:600;min-width:180px}
    .icon{font-size:18px}
    input[type="number"], input[type="date"]{
      padding:10px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fbfdff;min-width:160px;
    }
    input[type="number"]::-webkit-inner-spin-button { opacity: 0.6; }

    .controls{margin-left:auto;display:flex;gap:10px;align-items:center}
    button{cursor:pointer;padding:9px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:600}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(59,130,246,0.12)}
    button#resetBtn{background:var(--danger)}
    button#resetBtn:hover{background:#b21f2d}

    .expenses-list{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .row{
      display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;background:rgba(15,23,42,0.02);
      flex-wrap:wrap;border:1px solid rgba(15,23,42,0.03);
    }
    .row label{min-width:220px;white-space:nowrap}
    .row input[type="number"]{min-width:140px;max-width:220px}
    .add-row{display:flex;gap:8px;align-items:center;margin-left:auto}
    .add-row input{width:110px;padding:8px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
    .add-row button{padding:8px 10px;border-radius:8px;background:var(--success);color:#fff;border:0}
    .add-row button:hover{opacity:0.95}

    .editable-label{padding:6px;border-radius:6px;cursor:text;min-width:120px;display:inline-block}
    .editable-label[contenteditable="true"]{outline:2px dashed rgba(0,0,0,0.06)}

    .totals{display:flex;gap:12px;justify-content:flex-end;margin-top:18px;flex-wrap:wrap}
    .total-item{background:#ffffff;padding:14px;border-radius:12px;min-width:160px;box-shadow:0 6px 20px rgba(2,6,23,0.03);text-align:center}
    .total-item span{display:block;margin-top:8px;font-size:1.2rem;font-weight:700}
    .total-item.positive{color:var(--success)}

    footer{margin-top:22px;padding-top:10px;border-top:1px solid rgba(2,6,23,0.03);font-size:0.92rem;color:var(--muted)}

    @media (max-width:720px){
      label{min-width:140px}
      .add-row{width:100%;margin-left:0;justify-content:flex-start}
      .row{flex-direction:column;align-items:flex-start}
      .controls{width:100%;justify-content:flex-start;margin-top:8px}
    }
  </style>

  <!-- html2canvas + jsPDF (CDN) for screenshot-style PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="container" id="mainContent" role="main">
    <div class="greeting" role="banner">
      Welcome to your Home Budget Calculator!<br />
      Take control of your finances effortlessly and plan your spending smartly.<br />
      Let‚Äôs make budgeting simple, clear, and empowering for you!
    </div>

    <!-- Date & Deposits + Controls -->
    <div class="section">
      <div class="top-row">
        <div style="display:flex;gap:12px;align-items:center;">
          <label><span class="icon">üìÖ</span> Date</label>
          <input type="date" id="date" />
        </div>

        <div style="display:flex;gap:12px;align-items:center;">
          <label><span class="icon">üí∞</span> Deposits ‚Çπ</label>
          <input type="number" id="deposits" min="0" step="0.01" value="0" />
        </div>

        <div class="controls" aria-hidden="false">
          <div class="note" style="color:var(--muted);font-weight:600">Tip: double-click any item name to edit it.</div>
          <button id="exportPdfBtn" title="Export PDF">üìÑ Export PDF</button>
          <button id="resetBtn" title="Reset all fields">‚ü≤ Reset</button>
        </div>
      </div>
    </div>

    <!-- Expenses -->
    <div class="section">
      <h3 style="margin-top:0;color:#0b3a66">üè° Your Household Expenses</h3>

      <div class="expenses-list" id="expensesList">
        <!-- Rice -->
        <div class="row">
          <label>
            <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="52" height="36" viewBox="0 0 52 36"><rect rx="6" width="52" height="36" fill="%23fff7ea"/><path d="M26 6c6 3 8 8 8 12 0 6-6 10-8 12-2-2-8-6-8-12 0-4 2-9 8-12z" fill="%23f4c542"/></svg>' alt="Rice" />
            <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Rice ‚Çπ</span>
          </label>
          <input type="number" id="rice" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row">
            <input type="number" id="riceAdd" min="0" step="0.01" placeholder="0" />
            <button onclick="addTo('rice')">‚ûï Add</button>
          </div>
        </div>

        <!-- Electricity -->
        <div class="row">
          <label><span class="icon">‚ö°</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Electricity ‚Çπ</span></label>
          <input type="number" id="electricity" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="electricityAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('electricity')">‚ûï Add</button></div>
        </div>

        <!-- Milk -->
        <div class="row">
          <label>
            <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23f6fbff"/><path d="M28 6c-1-2-6-2-8 0l-2 4v16h16V10z" fill="%23fff"/><rect x="20" y="8" width="8" height="3" rx="1" fill="%23e6f2ff"/></svg>' alt="Milk" />
            <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Milk ‚Çπ</span>
          </label>
          <input type="number" id="milk" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="milkAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('milk')">‚ûï Add</button></div>
        </div>

        <!-- Cylinder -->
        <div class="row">
          <label>
            <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23fffaf0"/><path d="M14 12h20v10a6 6 0 0 1-6 6H20a6 6 0 0 1-6-6V12z" fill="%23f05454"/><rect x="18" y="8" width="12" height="6" rx="2" fill="%23fff"/></svg>' alt="Cylinder" />
            <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Cylinder ‚Çπ</span>
          </label>
          <input type="number" id="cylinder" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="cylinderAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('cylinder')">‚ûï Add</button></div>
        </div>

        <!-- Non-Veg -->
        <div class="row">
          <label><span class="icon">üçó</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Non-Veg ‚Çπ</span></label>
          <input type="number" id="nonveg" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="nonvegAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('nonveg')">‚ûï Add</button></div>
        </div>

        <!-- Eggs -->
        <div class="row">
          <label><span class="icon">ü•ö</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Eggs ‚Çπ</span></label>
          <input type="number" id="eggs" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="eggsAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('eggs')">‚ûï Add</button></div>
        </div>

        <!-- Veggies -->
        <div class="row">
          <label><span class="icon">ü•¨</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Veggies ‚Çπ</span></label>
          <input type="number" id="veggies" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="veggiesAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('veggies')">‚ûï Add</button></div>
        </div>

        <!-- Grocery Canteen -->
        <div class="row">
          <label><span class="icon">üõí</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Grocery Canteen ‚Çπ</span></label>
          <input type="number" id="canteen" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="canteenAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('canteen')">‚ûï Add</button></div>
        </div>

        <!-- Paneer -->
        <div class="row">
          <label><span class="icon">üßÄ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Paneer ‚Çπ</span></label>
          <input type="number" id="paneer" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="paneerAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('paneer')">‚ûï Add</button></div>
        </div>

        <!-- Extras -->
        <div class="row">
          <label><span class="icon">‚ú®</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Extras ‚Çπ</span></label>
          <input type="number" id="extras" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="extrasAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('extras')">‚ûï Add</button></div>
        </div>

        <!-- Snacks -->
        <div class="row">
          <label><span class="icon">üçø</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Snacks ‚Çπ</span></label>
          <input type="number" id="snacks" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="snacksAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('snacks')">‚ûï Add</button></div>
        </div>

        <!-- Ration Shop -->
        <div class="row">
          <label><span class="icon">üè™</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Ration Shop ‚Çπ</span></label>
          <input type="number" id="ration" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="rationAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('ration')">‚ûï Add</button></div>
        </div>

        <!-- Provision -->
        <div class="row">
          <label><span class="icon">üõí</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Provision ‚Çπ</span></label>
          <input type="number" id="provision" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="provisionAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('provision')">‚ûï Add</button></div>
        </div>

        <!-- Fruits -->
        <div class="row">
          <label><span class="icon">üçé</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Fruits ‚Çπ</span></label>
          <input type="number" id="fruits" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="fruitsAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('fruits')">‚ûï Add</button></div>
        </div>

        <!-- Cooking Oil -->
        <div class="row">
          <label>
            <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23fffef6"/><path d="M16 8h16v16a6 6 0 0 1-6 6H22a6 6 0 0 1-6-6V8z" fill="%23ffd166"/><path d="M24 6c2 0 2 2 0 2s-2-2 0-2z" fill="%23f4a261"/></svg>' alt="Oil" />
            <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Cooking Oil ‚Çπ</span>
          </label>
          <input type="number" id="oil" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="oilAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('oil')">‚ûï Add</button></div>
        </div>

        <!-- Curd -->
        <div class="row">
          <label><span class="icon">ü•õ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Curd ‚Çπ</span></label>
          <input type="number" id="curd" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="curdAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('curd')">‚ûï Add</button></div>
        </div>

        <!-- Water -->
        <div class="row">
          <label>
            <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23f0fbff"/><path d="M24 6c-4 6-8 8-8 12a8 8 0 0 0 16 0c0-4-4-6-8-12z" fill="%2300a1e4"/></svg>' alt="Water" />
            <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Water ‚Çπ</span>
          </label>
          <input type="number" id="water" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="waterAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('water')">‚ûï Add</button></div>
        </div>

        <!-- Flowers -->
        <div class="row">
          <label><span class="icon">üå∏</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Flowers ‚Çπ</span></label>
          <input type="number" id="flowers" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="flowersAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('flowers')">‚ûï Add</button></div>
        </div>

        <!-- Medical -->
        <div class="row">
          <label><span class="icon">üè•</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Medical ‚Çπ</span></label>
          <input type="number" id="medical" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="medicalAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('medical')">‚ûï Add</button></div>
        </div>

        <!-- Misc -->
        <div class="row">
          <label><span class="icon">üéÅ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Miscellaneous ‚Çπ</span></label>
          <input type="number" id="misc" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="miscAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('misc')">‚ûï Add</button></div>
        </div>

        <!-- Rent -->
        <div class="row">
          <label><span class="icon">üè†</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Rent ‚Çπ</span></label>
          <input type="number" id="rent" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="rentAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('rent')">‚ûï Add</button></div>
        </div>

        <!-- Broadband -->
        <div class="row">
          <label><span class="icon">üì°</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Broadband ‚Çπ</span></label>
          <input type="number" id="broadband" oninput="calculate()" placeholder="0" min="0" step="0.01" />
          <div class="add-row"><input id="broadbandAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('broadband')">‚ûï Add</button></div>
        </div>
        
<div id="addExpenseContainer" style="margin-top:10px; text-align:center; width:100%;">
          <button class="ghost" onclick="addNewExpenseField()" style="width:100%; border: 2px dashed rgba(59,130,246,0.25); justify-content: center;">
            ‚ûï Add New Expense Field
          </button>
        </div>

        <script>
          function addNewExpenseField() {
            // 1. Get container and button location
            var list = document.getElementById('expensesList');
            var btnContainer = document.getElementById('addExpenseContainer');
            
            // 2. Generate unique ID based on timestamp to prevent conflicts
            var uniqueId = 'custom_' + Date.now();

            // 3. Create the new row div
            var div = document.createElement('div');
            div.className = 'row';
            
            // 4. Set inner HTML matching existing structure
            div.innerHTML = `
              <label>
                <span class="icon">üìù</span>
                <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">New Expense ‚Çπ</span>
              </label>
              <input type="number" id="${uniqueId}" oninput="calculate()" placeholder="0" min="0" step="0.01" />
              <div class="add-row">
                <input id="${uniqueId}Add" type="number" min="0" step="0.01" placeholder="0" />
                <button onclick="addTo('${uniqueId}')">‚ûï Add</button>
              </div>
            `;

            // 5. Insert the new row before the "Add" button
            list.insertBefore(div, btnContainer);
          }
        </script>
        
      </div> <!-- end expenses-list -->
    </div> <!-- end expenses section -->

    <!-- Totals -->
    <div class="totals" aria-live="polite">
      <div class="total-item" id="expensesDisplay">üí∏ Expenses<br /><span id="expenses">‚Çπ0.00</span></div>
      <div class="total-item positive" id="balanceDisplay">‚öñÔ∏è Balance<br /><span id="balance">‚Çπ0.00</span></div>
    </div>

    <!-- Footer -->
    <footer>
      ¬© 2025 Home Budget Calculator. All rights reserved. Developed by Logesh.<br />
      <div style="color:var(--muted);margin-top:6px;font-size:0.92rem">
        Disclaimer: This website provides budgeting tools for informational purposes only and does not constitute financial advice. The developer is not responsible for any financial decisions made based on the information provided here. Users should consult a financial advisor for personalized guidance.
      </div>
    </footer>
  </div>

  <script>
    // List of expense input ids
    const expenseIds = [
      'rice','electricity','milk','cylinder','nonveg','eggs','veggies','canteen','paneer',
      'extras','snacks','ration','provision','fruits','oil','curd','water','flowers',
      'medical','misc','rent','broadband'
    ];

    // Format INR numbers
    function formatINR(num){
      if (isNaN(num)) return '‚Çπ0.00';
      return '‚Çπ' + Number(num).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    // Add small increment to main field
    function addTo(id){
      const addInput = document.getElementById(id + 'Add');
      const mainInput = document.getElementById(id);
      if(!mainInput || !addInput) return;
      const addVal = parseFloat(addInput.value) || 0;
      const current = parseFloat(mainInput.value) || 0;
      mainInput.value = (current + addVal).toFixed(2);
      addInput.value = '';
      calculate();
    }

    // Calculate total and balance (no persistence)
    function calculate(){
      let total = 0;
      expenseIds.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        const v = parseFloat(el.value) || 0;
        total += v;
      });
      document.getElementById('expenses').textContent = formatINR(total);
      const deposits = parseFloat(document.getElementById('deposits').value) || 0;
      const balance = deposits - total;
      document.getElementById('balance').textContent = formatINR(balance);
    }

    // Reset all fields to default (no localStorage)
    function resetAll(){
      document.getElementById('date').value = '';
      document.getElementById('deposits').value = 0;
      expenseIds.forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.value = '';
        const addEl = document.getElementById(id + 'Add');
        if(addEl) addEl.value = '';
      });
      calculate();
    }

    // Inline label editing
    function makeEditable(el){
      el.setAttribute('contenteditable','true');
      el.focus();
      document.execCommand('selectAll', false, null);
      document.getSelection().collapseToEnd();
    }
    function makeReadOnly(el){
      el.setAttribute('contenteditable','false');
      if(!el.textContent.trim()) el.textContent = 'Item ‚Çπ';
    }

    // Export PDF (screenshot-style) using html2canvas + jsPDF; paginates if necessary
    async function exportPDF(){
      const container = document.getElementById('mainContent');
      // hide interactive controls during capture
      const controls = document.querySelectorAll('.controls, .add-row button, .add-row input, #exportPdfBtn, #resetBtn');
      controls.forEach(c=>c.style.visibility = 'hidden');
      try{
        const canvas = await html2canvas(container, {scale:2, useCORS:true, logging:false, windowWidth: document.documentElement.scrollWidth, windowHeight: document.documentElement.scrollHeight});
        const imgData = canvas.toDataURL('image/png', 1.0);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({unit:'mm', format:'a4'});
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const imgW = canvas.width;
        const imgH = canvas.height;
        const margin = 8;
        const usablePageWidth = pageWidth - margin*2;
        const pdfImgHeight = (imgH * usablePageWidth) / imgW;
        if(pdfImgHeight <= pageHeight - margin*2){
          pdf.addImage(imgData, 'PNG', margin, margin, usablePageWidth, pdfImgHeight);
        } else {
          const pxPerPage = Math.floor((imgW * (pageHeight - margin*2)) / usablePageWidth);
          let position = 0;
          while(position < imgH){
            const sliceHeight = Math.min(pxPerPage, imgH - position);
            const canvasSlice = document.createElement('canvas');
            canvasSlice.width = imgW;
            canvasSlice.height = sliceHeight;
            const ctx = canvasSlice.getContext('2d');
            ctx.drawImage(canvas, 0, position, imgW, sliceHeight, 0, 0, imgW, sliceHeight);
            const chunkImg = canvasSlice.toDataURL('image/png');
            const chunkPdfHeight = (sliceHeight * usablePageWidth) / imgW;
            if(position !== 0) pdf.addPage();
            pdf.addImage(chunkImg, 'PNG', margin, margin, usablePageWidth, chunkPdfHeight);
            position += sliceHeight;
          }
        }
        // restore controls
        controls.forEach(c=>c.style.visibility = '');
        const fileName = 'Home-Budget-' + (document.getElementById('date').value || new Date().toISOString().slice(0,10)) + '.pdf';
        pdf.save(fileName);
      }catch(err){
        console.error('PDF export error:', err);
        // restore controls if error
        const controls2 = document.querySelectorAll('.controls, .add-row button, .add-row input, #exportPdfBtn, #resetBtn');
        controls2.forEach(c=>c.style.visibility = '');
        alert('PDF export failed. You can try to use your browser Print ‚Üí Save as PDF.');
      }
    }

    // Prevent Enter from submitting when editing number fields
    document.addEventListener('keydown', function(e){
      if(e.key === 'Enter' && e.target && e.target.tagName === 'INPUT' && e.target.type === 'number'){
        e.preventDefault();
      }
    });

    // Hook up buttons
    document.addEventListener('DOMContentLoaded', function(){
      // Ensure always fresh on open: clear any previously stored keys (defensive)
      try {
        // If your app ever used localStorage keys, remove them here to guarantee a fresh state
        localStorage.removeItem('homeBudget_snapshot');
        localStorage.removeItem('homeBudget_date');
      } catch(e){ /* ignore storage errors */ }

      // Always reset on open
      resetAll();

      // Wire buttons
      document.getElementById('resetBtn').addEventListener('click', function(){
        // confirm optional; immediate reset
        resetAll();
      });

      document.getElementById('exportPdfBtn').addEventListener('click', function(){
        exportPDF();
      });

      // Live calculate on deposits change
      document.getElementById('deposits').addEventListener('input', calculate);
    });
  </script>
</body>
</html>
